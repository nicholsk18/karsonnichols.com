---
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import Nav from "../components/Nav.astro";
import "@fontsource/lato/400.css";
import "@fontsource/lato/700.css";
import "@fontsource/lato/900.css";

const { title, description, image, article, publishDate, modifiedDate } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZQ12PJVEQ9"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-ZQ12PJVEQ9", {
        send_page_view: true,
      });

      window.trackEvent = function (eventName, eventParams = {}) {
        if (typeof gtag !== "undefined") {
          gtag("event", eventName, eventParams);
        }
      };
    </script>

    <BaseHead
      title={title}
      description={description}
      image={image}
      article={article}
      publishDate={publishDate}
      modifiedDate={modifiedDate}
    />
  </head>
  <body class="text-lg relative overflow-x-hidden">
    <!-- Simplified background shapes for mobile performance -->
    <div class="hidden md:block fixed inset-0 overflow-hidden pointer-events-none z-0">
      <div
        class="floating-shape absolute top-20 left-10 w-64 h-64 bg-blue-base/10 rounded-full blur-3xl animate-float-1"
      >
      </div>
      <div
        class="floating-shape absolute bottom-20 right-10 w-80 h-80 bg-orange-base/10 rounded-full blur-3xl animate-float-2"
      >
      </div>
      <div
        class="floating-shape absolute top-40 right-1/4 w-48 h-48 bg-blue-base/5 rounded-full blur-2xl animate-float-3"
      >
      </div>
      <div
        class="floating-shape absolute top-1/2 left-1/3 w-72 h-72 bg-orange-base/5 rounded-full blur-3xl animate-float-4"
      >
      </div>
    </div>
    <!-- Lightweight static background for mobile -->
    <div class="md:hidden fixed inset-0 overflow-hidden pointer-events-none z-0">
      <div class="absolute top-20 left-10 w-64 h-64 bg-blue-base/5 rounded-full blur-2xl"></div>
      <div class="absolute bottom-20 right-10 w-80 h-80 bg-orange-base/5 rounded-full blur-2xl">
      </div>
    </div>

    <div class="relative z-10">
      <Nav />

      <main>
        <slot />
      </main>

      <Footer />
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        document.addEventListener("click", function (e) {
          const target = e.target as HTMLElement;
          const button = target.closest("a, button");

          if (!button) return;

          const trackingLabel =
            button.getAttribute("data-track-label") ||
            button.textContent?.trim() ||
            "Unknown Button";

          const trackingCategory = button.getAttribute("data-track-category") || "Button Click";

          const buttonUrl = button.getAttribute("href") || "";

          if (button.classList.contains("btn") || button.getAttribute("data-track") === "true") {
            window.trackEvent("click", {
              event_category: trackingCategory,
              event_label: trackingLabel,
              value: buttonUrl,
            });
          }

          if (
            buttonUrl &&
            (buttonUrl.startsWith("http") || buttonUrl.startsWith("https")) &&
            !buttonUrl.includes(window.location.hostname)
          ) {
            window.trackEvent("outbound_link", {
              event_category: "Outbound Link",
              event_label: buttonUrl,
              value: trackingLabel,
            });
          }

          const lowerLabel = trackingLabel.toLowerCase();
          if (
            lowerLabel.includes("contact") ||
            lowerLabel.includes("get in touch") ||
            lowerLabel.includes("start") ||
            lowerLabel.includes("book") ||
            lowerLabel.includes("demo") ||
            lowerLabel.includes("quote")
          ) {
            window.trackEvent("cta_click", {
              event_category: "CTA",
              event_label: trackingLabel,
              value: buttonUrl,
            });
          }

          if (buttonUrl.includes("/projects/")) {
            window.trackEvent("project_view", {
              event_category: "Project",
              event_label: trackingLabel,
              value: buttonUrl,
            });
          }

          if (buttonUrl.includes("/blog/") && !buttonUrl.endsWith("/blog/")) {
            window.trackEvent("blog_view", {
              event_category: "Blog",
              event_label: trackingLabel,
              value: buttonUrl,
            });
          }
        });
      });
    </script>
  </body>
</html>

<style is:global>
  /* Global mobile performance optimizations */
  * {
    -webkit-tap-highlight-color: transparent;
  }

  /* Reduce motion for users who prefer it */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
      scroll-behavior: auto !important;
    }
  }

  /* Performance optimization for animations */
  .floating-shape {
    will-change: transform;
    transform: translateZ(0); /* Force hardware acceleration */
    backface-visibility: hidden;
  }

  /* Optimize backdrop-blur on mobile */
  @media (max-width: 767px) {
    [class*="backdrop-blur"] {
      backdrop-filter: none !important;
    }
  }

  /* Improve text rendering on mobile */
  body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeSpeed;
  }

  /* Optimize images for mobile */
  img,
  picture {
    image-rendering: -webkit-optimize-contrast;
  }

  @keyframes float-1 {
    0%,
    100% {
      transform: translate3d(0, 0, 0) scale(1);
    }
    50% {
      transform: translate3d(30px, 30px, 0) scale(1.1);
    }
  }

  @keyframes float-2 {
    0%,
    100% {
      transform: translate3d(0, 0, 0) scale(1);
    }
    50% {
      transform: translate3d(-30px, -20px, 0) scale(1.15);
    }
  }

  @keyframes float-3 {
    0%,
    100% {
      transform: translate3d(0, 0, 0) scale(1);
    }
    50% {
      transform: translate3d(20px, -30px, 0) scale(1.05);
    }
  }

  @keyframes float-4 {
    0%,
    100% {
      transform: translate3d(0, 0, 0) scale(1);
    }
    50% {
      transform: translate3d(-25px, 25px, 0) scale(1.08);
    }
  }

  /* Only animate on desktop or if user hasn't requested reduced motion */
  @media (min-width: 768px) and (prefers-reduced-motion: no-preference) {
    .animate-float-1 {
      animation: float-1 20s ease-in-out infinite;
    }

    .animate-float-2 {
      animation: float-2 25s ease-in-out infinite;
    }

    .animate-float-3 {
      animation: float-3 15s ease-in-out infinite;
    }

    .animate-float-4 {
      animation: float-4 22s ease-in-out infinite;
    }
  }
</style>
